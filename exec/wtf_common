#!/usr/bin/env bash

local nm_env="${CONTEXT_ORG}-${CONTEXT_ACCOUNT}"

function tf {
  local nm_cmd="$1"; shift

  local opt_tf_vars="-var-file=terraform.tfvars"

  mkdir -p "_${CONTEXT_ACCOUNT}"
	exec terraform "$nm_cmd" ${opt_tf_vars} \
    -var-file="_${CONTEXT_ACCOUNT}/terraform.tfvars" \
       -state="_${CONTEXT_ACCOUNT}/terraform.tfstate" \
      -backup="_${CONTEXT_ACCOUNT}/terraform.tfstate.backup" \
    "$@"
}

