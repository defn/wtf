#!/usr/bin/env bash

local nm_env="${CONTEXT_ORG}-${CONTEXT_ACCOUNT}"

function tf {
  local nm_cmd="$1"; shift

  local opt_tf_vars="-var-file=terraform.tfvars"

  mkdir -p "_${nm_env}"
	exec terraform "$nm_cmd" ${opt_tf_vars} \
    -var-file="_${nm_env}/terraform.tfvars" \
       -state="_${nm_env}/terraform.tfstate" \
      -backup="_${nm_env}/terraform.tfstate.backup" \
    "$@"
}

